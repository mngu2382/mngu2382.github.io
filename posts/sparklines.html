<!DOCTYPE html>
<html lang="en">
<head>
  <title>Sparklines</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="http://mngu2382.github.io/theme/css/main.css"/>
  <link rel="icon" type="image/x-icon" href="http://mngu2382.github.io/favicon.ico"/>

</head>

<body>
<header id="banner">
  <h1><a href="http://mngu2382.github.io/index.html">:testSite <strong>a work in progress</strong></a></h1>
  <nav><ul>
          <li ><a href="/pages/gh-pages.html">gh-pages</a></li>
          <li ><a href="/pages/about.html">About</a></li>
      </ul></nav><!-- /#menu -->
</header><!-- /#banner -->

<section id="content" class="body">
  <header>
    <h2 class="entry-title">Sparklines</h2>
        
  </header>
  <aside class="post-info1">
    <abbr class="published" title="2013-10-22T00:00:00">
      Tue 22 October 2013
    </abbr>
  </aside><!-- /.post-info -->
  <div>
    <p>Inspired by Tufte's
<a href="http://www.edwardtufte.com/bboard/q-and-a-fetch-msg?msg_id=0001OR">sparklines</a>
I prototyped the following data visualisation at work today. A
definition of sparklines given by Tutfe:</p>
<blockquote>
<p>A sparkline is a small intense, simple, word-sized graphic with
typographic resolution. Sparklines mean that graphics are no
longer cartoonish special occasions with captions and boxes, but
rather sparkline graphic can be everywhere a word or number can
be: embedded in a sentence, table, headline, map, spreadsheet,
graphic.</p>
</blockquote>
<p>The <a href="http://cran.r-project.org/web/packages/YaleToolkit/">Yale Toolkit</a>
on CRAN provides an implementaion of sparklines, but since it is not
easy for me to retrive and install packages at work, I thought I'd roll
my own (thanks to KM for the discussion on some of the visual aspects).
Although not quite word-size ...</p>
<p><img alt="Market report sparklines" src="/static/images/sparklines.png" title="Market report sparklines" /></p>
<p><em>R code for this image on
<a href="https://github.com/mngu2382/mngu2382.github.io/blob/src/extra/sparklines/sparklines.R">Github</a>. A
<a href="/static/images/sparklines.pdf">pdf</a> version of the image is also
available.</em></p>
<p><strong>NB</strong>: The data from work has been replaced with publically available
series from the <a href="http://www.rba.gov.au/statistics/by-subject.html">RBA</a>
and <a href="http://www.indexmundi.com/commodities/">IndexMundi</a>.</p>
<p>The last element that was add to the graphic was the gray background
on the  plots which made an enormous amount of difference, surprising
the crap out of me. I knew it would make a difference -- helping to
visually group elements and graph reading in general (&agrave; la
ggplot, which cites the advice of Tufte, Brewer and Carr
<a href="#ref1">[1]</a>) -- but the improvement still surprised.</p>
<p>For the rest of this post I will walk through some of the corners of
R the I learnt while trying to figure this one out. <em>Complete R code
for the examples on
<a href="https://github.com/mngu2382/mngu2382.github.io/blob/src/extra/sparklines/examples.R">Github</a>.</em></p>
<h4>The layout function</h4>
<p>The
<a href="http://stat.ethz.ch/R-manual/R-devel/library/graphics/html/layout.html">layout</a>
function is a way to divide the graphics device up in a
manner similar to, yet more flexibly than, the <code>mfrow</code>/<code>mfcol</code>
properties in <code>par</code>. For example the following two code chunks produce
equivalent outputs:</p>
<div class="highlight"><pre><span class="c1"># default par values</span>
opar <span class="o">&lt;-</span> par<span class="p">(</span>no.readonly<span class="o">=</span><span class="k-Variable">T</span><span class="p">)</span>

<span class="c1"># Firstly an mfrow example</span>
<span class="c1"># use mfcol if you want to fill by column</span>
par<span class="p">(</span>mfcol<span class="o">=</span>c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> mar<span class="o">=</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
<span class="kr">for</span> <span class="p">(</span>i in <span class="m">1</span>:<span class="m">4</span><span class="p">)</span> <span class="p">{</span>
    plot<span class="p">(</span><span class="m">1</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> axes<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    text<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> i<span class="p">)</span>
    box<span class="p">()</span>
<span class="p">}</span>

<span class="c1"># revert to original par values</span>
par<span class="p">(</span>opar<span class="p">)</span>

<span class="c1"># Equivalent layout example</span>
<span class="c1"># use byrow=F if you want to fill by column</span>
layout<span class="p">(</span>matrix<span class="p">(</span><span class="m">1</span>:<span class="m">4</span><span class="p">,</span> nrow<span class="o">=</span><span class="m">2</span><span class="p">,</span> byrow<span class="o">=</span><span class="k-Variable">T</span><span class="p">))</span>
par<span class="p">(</span>mar<span class="o">=</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>
<span class="kr">for</span> <span class="p">(</span>i in <span class="m">1</span>:<span class="m">4</span><span class="p">)</span> <span class="p">{</span>
    plot<span class="p">(</span><span class="m">1</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> axes<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    text<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> i<span class="p">)</span>
    box<span class="p">()</span>
<span class="p">}</span>
</pre></div>


<p><img alt="Layout example 1" src="/static/images/sparklines_example1.png" title="Using layout to achieve the same result as mfrow/mfcol" /></p>
<p>With layout, figures can also be relatively sized and cells merged:</p>
<div class="highlight"><pre><span class="c1"># Layout with varying sizes, can similarly adjust the height</span>
layout<span class="p">(</span>matrix<span class="p">(</span><span class="m">1</span>:<span class="m">4</span><span class="p">,</span> nrow<span class="o">=</span><span class="m">2</span><span class="p">,</span> byrow<span class="o">=</span><span class="k-Variable">T</span><span class="p">),</span> width<span class="o">=</span>c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>
par<span class="p">(</span>mar<span class="o">=</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>
<span class="kr">for</span> <span class="p">(</span>i in <span class="m">1</span>:<span class="m">4</span><span class="p">)</span> <span class="p">{</span>
    plot<span class="p">(</span><span class="m">1</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> axes<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    text<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> i<span class="p">)</span>
    box<span class="p">()</span>
<span class="p">}</span>
</pre></div>


<p><img alt="Layout example 2" src="/static/images/sparklines_example2.png" title="Layout with resized figures" /></p>
<div class="highlight"><pre>layout<span class="p">(</span>matrix<span class="p">(</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span>
                <span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">),</span> nrow<span class="o">=</span><span class="m">2</span><span class="p">,</span> byrow<span class="o">=</span><span class="k-Variable">T</span><span class="p">),</span> width<span class="o">=</span>c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>
<span class="kr">for</span> <span class="p">(</span>i in <span class="m">1</span>:<span class="m">4</span><span class="p">)</span> <span class="p">{</span>
    plot<span class="p">(</span><span class="m">1</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> axes<span class="o">=</span><span class="k-Variable">F</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    text<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> i<span class="p">)</span>
    box<span class="p">()</span>
<span class="p">}</span>

par<span class="p">(</span>opar<span class="p">)</span>
</pre></div>


<p><img alt="Layout example 3" src="/static/images/sparklines_example3.png" title="Layout with merged cells" /></p>
<p>For the market report, I've simply used a 8  by 3 grid layout:
<img alt="Layout example 4" src="/static/images/sparklines_example4.png" title="Layout used in market report" /></p>
<h4>R graphics coordinate systems and grconvertX/grconvertY</h4>
<p>The <a href="http://stat.ethz.ch/R-manual/R-devel/library/graphics/html/convertXY.html">grconvertX/grconvertY</a>
functions convert between the different graphic coordinate system in
R. The man page of grconvertX/grconvertY lists seven different
coordinate system, the difference is in the units they use (e.g. the
units of the data, inches, pixels, or a normalised value between 0 and
1) and where the origin is placed (in the plot area, the figure area or
the device area).</p>
<p>In the following example we plot at the centres with respect to the
data (<code>"user"</code> coordinates), the plot area (using the <code>"npc"</code>,
<strong>n</strong>ormalised <strong>p</strong>lot <strong>c</strong>oordinates), the figure area (using the
<code>"nfg"</code>, <strong>n</strong>ormalised <strong>f</strong>igure <strong>c</strong>ordinates) and the device area
(using the <code>"ndc"</code>, <strong>n</strong>ormalised <strong>d</strong>evice <strong>c</strong>ordinates).</p>
<div class="highlight"><pre>par<span class="p">(</span>oma<span class="o">=</span>c<span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> mar<span class="o">=</span>c<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="m">0.1</span><span class="p">,</span> cex<span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
plot<span class="p">(</span><span class="m">1</span>:<span class="m">10</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
box<span class="p">(</span><span class="s">&quot;plot&quot;</span><span class="p">,</span> lty<span class="o">=</span><span class="m">1</span><span class="p">)</span>
box<span class="p">(</span><span class="s">&quot;figure&quot;</span><span class="p">,</span> lty<span class="o">=</span><span class="m">2</span><span class="p">)</span>
box<span class="p">(</span><span class="s">&quot;outer&quot;</span><span class="p">,</span> lty<span class="o">=</span><span class="m">3</span><span class="p">)</span>
mtext<span class="p">(</span>c<span class="p">(</span><span class="s">&quot;Device/Outer&quot;</span><span class="p">,</span> <span class="s">&quot;Figure/Inner&quot;</span><span class="p">,</span> <span class="s">&quot;Plot&quot;</span><span class="p">),</span>
      <span class="m">1</span><span class="p">,</span> line<span class="o">=</span>c<span class="p">(</span><span class="m">6.1</span><span class="p">,</span> <span class="m">3.1</span><span class="p">,</span> <span class="m">-1</span><span class="p">),</span> cex<span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
</pre></div>


<p><img alt="grconvert example" src="/static/images/sparklines_example5.png" title="grconvert example" /></p>
<div class="highlight"><pre><span class="c1"># centre of data</span>
points<span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> pch<span class="o">=</span><span class="m">19</span><span class="p">)</span>
text<span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="s">&quot;user: (5, 5)&quot;</span><span class="p">,</span> pos<span class="o">=</span><span class="m">4</span><span class="p">)</span>

<span class="c1"># centre of plot area</span>
points<span class="p">(</span>grconvertX<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;npc&quot;</span><span class="p">),</span> grconvertY<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;npc&quot;</span><span class="p">),</span> col<span class="o">=</span><span class="m">2</span><span class="p">,</span> pch<span class="o">=</span><span class="m">19</span><span class="p">)</span>
text<span class="p">(</span>grconvertX<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;npc&quot;</span><span class="p">),</span> grconvertY<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;npc&quot;</span><span class="p">),</span>
     <span class="s">&quot;npc: (0.5, 0.5)&quot;</span><span class="p">,</span> pos<span class="o">=</span><span class="m">4</span><span class="p">,</span> col<span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># centre of figure area</span>
points<span class="p">(</span>grconvertX<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;nfc&quot;</span><span class="p">),</span> grconvertY<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;nfc&quot;</span><span class="p">),</span> col<span class="o">=</span><span class="m">3</span><span class="p">,</span> pch<span class="o">=</span><span class="m">19</span><span class="p">)</span>
text<span class="p">(</span>grconvertX<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;nfc&quot;</span><span class="p">),</span> grconvertY<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;nfc&quot;</span><span class="p">),</span>
     <span class="s">&quot;nfc: (0.5, 0.5)&quot;</span><span class="p">,</span> pos<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="m">3</span><span class="p">)</span>

<span class="c1"># centre of outer/device area</span>
points<span class="p">(</span>grconvertX<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;ndc&quot;</span><span class="p">),</span> grconvertY<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;ndc&quot;</span><span class="p">),</span> col<span class="o">=</span><span class="m">4</span><span class="p">,</span> pch<span class="o">=</span><span class="m">19</span><span class="p">)</span>
text<span class="p">(</span>grconvertX<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;ndc&quot;</span><span class="p">),</span> grconvertY<span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="s">&quot;ndc&quot;</span><span class="p">),</span>
     <span class="s">&quot;ndc: (0.5, 0.5)&quot;</span><span class="p">,</span> pos<span class="o">=</span><span class="m">2</span><span class="p">,</span> col<span class="o">=</span><span class="m">4</span><span class="p">)</span>
</pre></div>


<h4>Reference</h4>
<p><a name="ref1"> </a>
[1] H. Wickham. <em>ggplot2: elegant graphics for data analysis</em>. Springer
New York, 2009. 8.1.1 Built-in themes.</p>
  </div><!-- /.entry-content -->
  <footer>
    </footer> 
</section>

<footer class="body">
  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0;display:inline" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a> This work is licensed under a
  <br />
  <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.
  <br />
  Hosted on <a href="http://github.com/">GitHub</a>, powered by
  <a href="http://getpelican.com/">Pelican</a>.
</footer>

</body>
</html>
